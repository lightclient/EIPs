<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https:&#x2F;&#x2F;eips.ethereum.com&#x2F;minima.css">

        <!-- opengraph -->
        <meta property="og:locale" content="en_US" />
        <meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.com" />
        <meta property="og:site_name" content="Ethereum Improvement Proposals" />

        <!-- twitter -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@ethereum" />

        <script type="application/ld+json">
            {
              "@type": "WebSite",
              "url": "https:&#x2F;&#x2F;eips.ethereum.com",
              "name": "Ethereum Improvement Proposals",
              "description": "Description",
              "@context": "https://schema.org"
            }
        </script>

        

        

<title>EIP-7: DELEGATECALL</title>
<link rel="canonical" href="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-7.md" />
<meta property="og:title" content="EIP-7: DELEGATECALL" />
<meta
    name="description"
    content="Details on Ethereum Improvement Proposal 7 (EIP-7): DELEGATECALL"
/>
<meta
    property="og:description"
    content="Details on Ethereum Improvement Proposal 7 (EIP-7): DELEGATECALL"
/>
<meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-7.md" />
<meta name="twitter:description" content="Details on Ethereum Improvement Proposal 7 (EIP 7): DELEGATECALL" />

    </head>
    <body>
        <header class="site-header">
            <div class="wrapper">
                <a class="site-title" rel="author" href="https:&#x2F;&#x2F;eips.ethereum.com">Ethereum Improvement Proposals</a>
                <nav class="site-nav">
                    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                    <label for="nav-trigger">
                        <span class="menu-icon">
                            <svg viewBox="0 0 18 15" width="18px" height="15px">
                                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                            </svg>
                        </span>
                    </label>

                    <div class="trigger">
                        
                            <a class="page-link" href="&#x2F;all">All</a>
                        
                            <a class="page-link" href="&#x2F;core">Core</a>
                        
                            <a class="page-link" href="&#x2F;networking">Networking</a>
                        
                            <a class="page-link" href="&#x2F;interface">Interface</a>
                        
                            <a class="page-link" href="&#x2F;erc">ERC</a>
                        
                            <a class="page-link" href="&#x2F;meta">Meta</a>
                        
                            <a class="page-link" href="&#x2F;informational">Informational</a>
                        
                    </div>
                </nav>
            </div>
        </header>
        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                
<div class="home">
    <h1 class="page-heading">
        EIP-7: DELEGATECALL
        <a href=""><svg role="img" aria-label="Source" xmlns="https://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><title>Source</title><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"/></svg></a>
    </h1>
    <table>
        <tr>
            <th>Author</th>
            <td>
    
        
        
            <a href="mailto:v@buterin.com">Vitalik Buterin</a>
        
    
</td>
        </tr>

        

        <tr>
            <th>Status</th>
            <td>
                Final
                
            </td>
        </tr>

        <tr>
            <th>Type</th>
            <td>Standards Track</td>
        </tr>

        
          <tr>
              <th>Category</th>
              <td>Core</td>
          </tr>
        

        <tr>
            <th>Created</th>
            <td>2015-11-15</td>
        </tr>

        

        

        

        

        
  </table>

  
    <h3 id="hard-fork">Hard Fork</h3>
<p><a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-606.md">Homestead</a></p>
<h3 id="parameters">Parameters</h3>
<ul>
<li>Activation:
<ul>
<li>Block &gt;= 1,150,000 on Mainnet</li>
<li>Block &gt;= 494,000 on Morden</li>
<li>Block &gt;= 0 on future testnets</li>
</ul>
</li>
</ul>
<h3 id="overview">Overview</h3>
<p>Add a new opcode, <code>DELEGATECALL</code> at <code>0xf4</code>, which is similar in idea to <code>CALLCODE</code>, except that it propagates the sender and value from the parent scope to the child scope, i.e. the call created has the same sender and value as the original call.</p>
<h3 id="specification">Specification</h3>
<p><code>DELEGATECALL</code>: <code>0xf4</code>, takes 6 operands:</p>
<ul>
<li><code>gas</code>: the amount of gas the code may use in order to execute;</li>
<li><code>to</code>: the destination address whose code is to be executed;</li>
<li><code>in_offset</code>: the offset into memory of the input;</li>
<li><code>in_size</code>: the size of the input in bytes;</li>
<li><code>out_offset</code>: the offset into memory of the output;</li>
<li><code>out_size</code>: the size of the scratch pad for the output.</li>
</ul>
<h4 id="notes-on-gas">Notes on gas</h4>
<ul>
<li>The basic stipend is not given; <code>gas</code> is the total amount the callee receives.</li>
<li>Like <code>CALLCODE</code>, account creation never happens, so the upfront gas cost is always <code>schedule.callGas</code> + <code>gas</code>.</li>
<li>Unused gas is refunded as normal.</li>
</ul>
<h4 id="notes-on-sender">Notes on sender</h4>
<ul>
<li><code>CALLER</code> and <code>VALUE</code> behave exactly in the callee's environment as they do in the caller's environment.</li>
</ul>
<h4 id="other-notes">Other notes</h4>
<ul>
<li>The depth limit of 1024 is still preserved as normal.</li>
</ul>
<h3 id="rationale">Rationale</h3>
<p>Propagating the sender and value from the parent scope to the child scope makes it much easier for a contract to store another address as a mutable source of code and ''pass through'' calls to it, as the child code would execute in essentially the same environment (except for reduced gas and increased callstack depth) as the parent.</p>
<p>Use case 1: split code to get around 3m gas barrier</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">~</span><span style="color:#bf616a;">calldatacopy</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, ~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">())
</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">~</span><span style="color:#bf616a;">calldataload</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) &lt; </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">**</span><span style="color:#d08770;">253</span><span style="color:#c0c5ce;">:
    ~</span><span style="color:#bf616a;">delegate_call</span><span style="color:#c0c5ce;">(msg.gas - </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">, $</span><span style="color:#bf616a;">ADDR1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, ~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), ~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">)
    ~</span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;">(~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">)
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">~</span><span style="color:#bf616a;">calldataload</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) &lt; </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">**</span><span style="color:#d08770;">253 </span><span style="color:#c0c5ce;">* </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">:
    ~</span><span style="color:#bf616a;">delegate_call</span><span style="color:#c0c5ce;">(msg.gas - </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">, $</span><span style="color:#bf616a;">ADDR2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, ~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), ~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">)
    ~</span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;">(~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">)
...
</span></code></pre>
<p>Use case 2: mutable address for storing the code of a contract:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">~</span><span style="color:#bf616a;">calldataload</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) / </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">**</span><span style="color:#d08770;">224 </span><span style="color:#c0c5ce;">== </span><span style="color:#d08770;">0x12345678 </span><span style="color:#c0c5ce;">and </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.owner == msg.sender:
    </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.delegate = ~</span><span style="color:#bf616a;">calldataload</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">)
</span><span style="color:#b48ead;">else</span><span style="color:#c0c5ce;">:
    ~</span><span style="color:#bf616a;">delegate_call</span><span style="color:#c0c5ce;">(msg.gas - </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.delegate, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, ~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), ~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">)
    ~</span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;">(~</span><span style="color:#bf616a;">calldatasize</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">)
</span></code></pre>
<p>The child functions called by these methods can now freely reference <code>msg.sender</code> and <code>msg.value</code>.</p>
<h3 id="possible-arguments-against">Possible arguments against</h3>
<ul>
<li>You can replicate this functionality by just sticking the sender into the first twenty bytes of the call data. However, this would mean that code would need to be specially compiled for delegated contracts, and would not be usable in delegated and raw contexts at the same time.</li>
</ul>



            </div>
        </main>


        <footer class="site-footer h-card">
            <div class="wrapper">
                <h2 class="footer-heading">Ethereum Improvement Proposals</h2>
                <div class="footer-col-wrapper">
                    <div class="footer-col footer-col-1">
                        <ul class="contact-list">
                            <li class="p-name">
                                
                                GitHub User
                                
                            </li>
                            <li>
                                <a class="u-email" href="mailto:your-email@domain.com">
                                  your-email@domain.com
                                </a>
                              </li>
                            </ul>
                    </div>
                    <div class="footer-col footer-col-3">
                        <p>Description</p>
                    </div>
                </div>
            </div>
        </footer>
    </body>
</html>
