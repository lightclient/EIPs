<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https:&#x2F;&#x2F;eips.ethereum.com&#x2F;minima.css">

        <!-- opengraph -->
        <meta property="og:locale" content="en_US" />
        <meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.com" />
        <meta property="og:site_name" content="Ethereum Improvement Proposals" />

        <!-- twitter -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@ethereum" />

        <script type="application/ld+json">
            {
              "@type": "WebSite",
              "url": "https:&#x2F;&#x2F;eips.ethereum.com",
              "name": "Ethereum Improvement Proposals",
              "description": "Description",
              "@context": "https://schema.org"
            }
        </script>

        

        

<title>EIP-2831: Transaction Replacement Message Type</title>
<link rel="canonical" href="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-2831.md" />
<meta property="og:title" content="EIP-2831: Transaction Replacement Message Type" />
<meta
    name="description"
    content="Details on Ethereum Improvement Proposal 2831 (EIP-2831): Transaction Replacement Message Type"
/>
<meta
    property="og:description"
    content="Details on Ethereum Improvement Proposal 2831 (EIP-2831): Transaction Replacement Message Type"
/>
<meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-2831.md" />
<meta name="twitter:description" content="Details on Ethereum Improvement Proposal 2831 (EIP 2831): Transaction Replacement Message Type" />

    </head>
    <body>
        <header class="site-header">
            <div class="wrapper">
                <a class="site-title" rel="author" href="https:&#x2F;&#x2F;eips.ethereum.com">Ethereum Improvement Proposals</a>
                <nav class="site-nav">
                    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                    <label for="nav-trigger">
                        <span class="menu-icon">
                            <svg viewBox="0 0 18 15" width="18px" height="15px">
                                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                            </svg>
                        </span>
                    </label>

                    <div class="trigger">
                        
                            <a class="page-link" href="&#x2F;all">All</a>
                        
                            <a class="page-link" href="&#x2F;core">Core</a>
                        
                            <a class="page-link" href="&#x2F;networking">Networking</a>
                        
                            <a class="page-link" href="&#x2F;interface">Interface</a>
                        
                            <a class="page-link" href="&#x2F;erc">ERC</a>
                        
                            <a class="page-link" href="&#x2F;meta">Meta</a>
                        
                            <a class="page-link" href="&#x2F;informational">Informational</a>
                        
                    </div>
                </nav>
            </div>
        </header>
        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                
<div class="home">
    <h1 class="page-heading">
        EIP-2831: Transaction Replacement Message Type
        <a href=""><svg role="img" aria-label="Source" xmlns="https://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><title>Source</title><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"/></svg></a>
    </h1>
    <table>
        <tr>
            <th>Author</th>
            <td>
    
        
        
            <a href="https://github.com/GregTheGreek">Gregory Markou</a>
        
    
</td>
        </tr>

        
          <tr>
              <th>Discussions-To</th>
              <td><a href="https:&#x2F;&#x2F;ethereum-magicians.org&#x2F;t&#x2F;eip-2831-transaction-replacement-message-type&#x2F;4448">https:&#x2F;&#x2F;ethereum-magicians.org&#x2F;t&#x2F;eip-2831-transaction-replacement-message-type&#x2F;4448</a></td>
          </tr>
        

        <tr>
            <th>Status</th>
            <td>
                Draft
                
            </td>
        </tr>

        <tr>
            <th>Type</th>
            <td>Standards Track</td>
        </tr>

        
          <tr>
              <th>Category</th>
              <td>Interface</td>
          </tr>
        

        <tr>
            <th>Created</th>
            <td>2020-07-26</td>
        </tr>

        

        
          <tr>
              <th>Requires</th>
              <td>1193</td>
          </tr>
        

        

        

        
  </table>

  
    <h2 id="summary">Summary</h2>
<p>An extension to the JavaScript Ethereum Provider API (<a href="https://eips.ethereum.com/EIPS/eip-1193/">EIP-1193</a>) this creates a new message type in the event a transaction replacement occurs.</p>
<h2 id="abstract">Abstract</h2>
<p>The current communication between providers and consumers of providers are fundamentally broken in the event that a transaction in the mempool has been superseded by a newer transactions. Providers currently have no way of communicating a transaction replacement, and consumers are required to poll block by block for the resulting transaction.</p>
<h2 id="motivation">Motivation</h2>
<p>Exert from EIP-1193</p>
<blockquote>
<p>A common convention in the Ethereum web application (&quot;dapp&quot;) ecosystem is for key management software (&quot;wallets&quot;) to expose their API via a JavaScript object in the web page.
This object is called &quot;the Provider&quot;.</p>
</blockquote>
<p>Many ingenious developments have been made by wallet developers to improve the overall user experience while interacting with the Ethereum blockchain. One specific innovation was transaction replacement, offering users the ability to effectively cancel a previously sent transaction.</p>
<p>Transaction replacement is not a new concept, but unfortunately causes major user experience problems for dapp developers as the replaced transaction is near impossible to track. </p>
<p>This EIP formalizes a way for both providers and dapp developers to track transaction replacements seamlessly.</p>
<h2 id="specification">Specification</h2>
<p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC-2119</a>.</p>
<h3 id="definitions">Definitions</h3>
<p><em>This section is non-normative.</em></p>
<ul>
<li>Provider
<ul>
<li>A JavaScript object made available to a consumer, that provides access to Ethereum by means of a Client.</li>
</ul>
</li>
<li>Wallet
<ul>
<li>An end-user application that manages private keys, performs signing operations, and acts as a middleware between the Provider and the Client.</li>
</ul>
</li>
<li>Transaction Replacement
<ul>
<li>Submitting a transaction with both: the same nonce and a 10% increase in the gas price, of a previous transaction which a user no longer wishes to send. This must occur before the original transaction is included in the blockchain.</li>
</ul>
</li>
</ul>
<h3 id="interface">Interface</h3>
<p>The <code>data</code> parameter contains two values: <code>oldTx</code> and <code>newTx</code>,the transaction hash that's being superseded and the transaction hash of the successor, respectively. Both <code>oldTx</code> and <code>newTx</code> should be encoded hex numbers as strings with the <code>0x</code> prefixed.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">interface TxReplacement extends ProviderMessage </span><span style="color:#c0c5ce;">{
  </span><span style="color:#bf616a;">readonly </span><span style="color:#c0c5ce;">type: &#39;</span><span style="color:#a3be8c;">tx_replacement</span><span style="color:#c0c5ce;">&#39;;
  </span><span style="color:#bf616a;">readonly </span><span style="color:#c0c5ce;">data: {
    </span><span style="color:#bf616a;">readonly </span><span style="color:#c0c5ce;">oldTx: </span><span style="color:#bf616a;">string</span><span style="color:#c0c5ce;">;
    </span><span style="color:#bf616a;">readonly </span><span style="color:#c0c5ce;">newTx: </span><span style="color:#bf616a;">string</span><span style="color:#c0c5ce;">;
  };
}
</span></code></pre><h2 id="rationale">Rationale</h2>
<p>The implementation was chosen to help the ease of implementation for both providers and dapp developers. Since <code>ProviderMessage</code> is widely used by dapp developers already it means that the implementation path would be as trivial as adding and additional <code>if</code> clause to their existing message listener. This also provides a benefit to dapps in the event that a provider has not yet implemented the <code>tx_replacement</code> and will not cause the dapp panic with <code>undefined</code> should it be implemented natively (eg: <code>ethereum.txReplacement(txHash, cb())</code> which would error with <code>ethereum.txReplacement()</code> is not a function).</p>
<h2 id="backwards-compatibility">Backwards Compatibility</h2>
<p>Many Providers adopted EIP-1193, as this EIP extends the arbitrary <code>message</code> event, there should be no breaking changes. All providers that do not support the new <code>tx_replacement</code> message should either I) Ignore the message or II) Provide some error to the user (Out of scope).</p>
<h2 id="implementations">Implementations</h2>
<p>At the time of writing, no projects have working implementations.</p>
<h2 id="security-considerations">Security Considerations</h2>
<p>None at the current time.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/ethereum/web3.js/issues/3585">Web3.js issue with metamask tx cancel</a></li>
<li><a href="https://github.com/MetaMask/metamask-extension/issues/3347">Browser doesn't know when a transaction is replace</a></li>
</ul>
<h2 id="copyright">Copyright</h2>
<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
<h2 id="appendix-i-examples">Appendix I: Examples</h2>
<p>These examples assume a web browser environment.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;">// Most Providers are available as window.ethereum on page load.
// This is only a convention, not a standard, and may not be the case in practice.
// Please consult the Provider implementation&#39;s documentation.
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">ethereum </span><span style="color:#c0c5ce;">= window.ethereum;

</span><span style="color:#bf616a;">ethereum</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">on</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">message</span><span style="color:#c0c5ce;">&#39;, (message) </span><span style="color:#b48ead;">=&gt; </span><span style="color:#c0c5ce;">{
  </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">message</span><span style="color:#c0c5ce;">.type === &#39;</span><span style="color:#a3be8c;">tx_replacement</span><span style="color:#c0c5ce;">&#39;) {
    </span><span style="color:#b48ead;">const </span><span style="color:#c0c5ce;">{ </span><span style="color:#bf616a;">oldTx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">newTx </span><span style="color:#c0c5ce;">} = </span><span style="color:#bf616a;">message</span><span style="color:#c0c5ce;">.data;
    console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(`</span><span style="color:#a3be8c;">Tx </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">oldTx</span><span style="color:#c0c5ce;">}</span><span style="color:#a3be8c;"> was cancelled, the new hash is </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">newTx</span><span style="color:#c0c5ce;">}`)
  }
});

</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">transactionParameters </span><span style="color:#c0c5ce;">= { ... } </span><span style="color:#65737e;">// Fill in parameters

</span><span style="color:#bf616a;">ethereum
  </span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">request</span><span style="color:#c0c5ce;">({ 
    method: &#39;</span><span style="color:#a3be8c;">eth_sendTransaction</span><span style="color:#c0c5ce;">&#39;,
    params: [</span><span style="color:#bf616a;">transactionParameters</span><span style="color:#c0c5ce;">],
  })
  .</span><span style="color:#bf616a;">then</span><span style="color:#c0c5ce;">((txHash) </span><span style="color:#b48ead;">=&gt; </span><span style="color:#c0c5ce;">{
    console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(`</span><span style="color:#a3be8c;">Transaction hash </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">txHash</span><span style="color:#c0c5ce;">}`)
  })
  .</span><span style="color:#bf616a;">catch</span><span style="color:#c0c5ce;">((error) </span><span style="color:#b48ead;">=&gt; </span><span style="color:#c0c5ce;">{
    console.</span><span style="color:#96b5b4;">error</span><span style="color:#c0c5ce;">(`</span><span style="color:#a3be8c;">Error sending transaction: </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">error</span><span style="color:#c0c5ce;">.code}</span><span style="color:#a3be8c;">: </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">error</span><span style="color:#c0c5ce;">.message}`);
  });

</span></code></pre>


            </div>
        </main>


        <footer class="site-footer h-card">
            <div class="wrapper">
                <h2 class="footer-heading">Ethereum Improvement Proposals</h2>
                <div class="footer-col-wrapper">
                    <div class="footer-col footer-col-1">
                        <ul class="contact-list">
                            <li class="p-name">
                                
                                GitHub User
                                
                            </li>
                            <li>
                                <a class="u-email" href="mailto:your-email@domain.com">
                                  your-email@domain.com
                                </a>
                              </li>
                            </ul>
                    </div>
                    <div class="footer-col footer-col-3">
                        <p>Description</p>
                    </div>
                </div>
            </div>
        </footer>
    </body>
</html>
