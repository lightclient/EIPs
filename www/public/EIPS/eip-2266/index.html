<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https:&#x2F;&#x2F;eips.ethereum.com&#x2F;minima.css">

        <!-- opengraph -->
        <meta property="og:locale" content="en_US" />
        <meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.com" />
        <meta property="og:site_name" content="Ethereum Improvement Proposals" />

        <!-- twitter -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@ethereum" />

        <script type="application/ld+json">
            {
              "@type": "WebSite",
              "url": "https:&#x2F;&#x2F;eips.ethereum.com",
              "name": "Ethereum Improvement Proposals",
              "description": "Description",
              "@context": "https://schema.org"
            }
        </script>

        

        

<title>EIP-2266: Atomic Swap-based American Call Option Contract Standard</title>
<link rel="canonical" href="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-2266.md" />
<meta property="og:title" content="EIP-2266: Atomic Swap-based American Call Option Contract Standard" />
<meta
    name="description"
    content="Details on Ethereum Improvement Proposal 2266 (EIP-2266): Atomic Swap-based American Call Option Contract Standard"
/>
<meta
    property="og:description"
    content="Details on Ethereum Improvement Proposal 2266 (EIP-2266): Atomic Swap-based American Call Option Contract Standard"
/>
<meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-2266.md" />
<meta name="twitter:description" content="Details on Ethereum Improvement Proposal 2266 (EIP 2266): Atomic Swap-based American Call Option Contract Standard" />

    </head>
    <body>
        <header class="site-header">
            <div class="wrapper">
                <a class="site-title" rel="author" href="https:&#x2F;&#x2F;eips.ethereum.com">Ethereum Improvement Proposals</a>
                <nav class="site-nav">
                    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                    <label for="nav-trigger">
                        <span class="menu-icon">
                            <svg viewBox="0 0 18 15" width="18px" height="15px">
                                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                            </svg>
                        </span>
                    </label>

                    <div class="trigger">
                        
                            <a class="page-link" href="&#x2F;all">All</a>
                        
                            <a class="page-link" href="&#x2F;core">Core</a>
                        
                            <a class="page-link" href="&#x2F;networking">Networking</a>
                        
                            <a class="page-link" href="&#x2F;interface">Interface</a>
                        
                            <a class="page-link" href="&#x2F;erc">ERC</a>
                        
                            <a class="page-link" href="&#x2F;meta">Meta</a>
                        
                            <a class="page-link" href="&#x2F;informational">Informational</a>
                        
                    </div>
                </nav>
            </div>
        </header>
        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                
<div class="home">
    <h1 class="page-heading">
        EIP-2266: Atomic Swap-based American Call Option Contract Standard
        <a href=""><svg role="img" aria-label="Source" xmlns="https://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><title>Source</title><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"/></svg></a>
    </h1>
    <table>
        <tr>
            <th>Author</th>
            <td>
    
        
        
            <a href="mailto:runchao.han@monash.edu">Runchao Han</a>,
        
    
        
        
            <a href="mailto:chris.haoyul@gmail.com">Haoyu Lin</a>,
        
    
        
        
            <a href="mailto:jiangshan.yu@monash.edu">Jiangshan Yu</a>
        
    
</td>
        </tr>

        
          <tr>
              <th>Discussions-To</th>
              <td><a href="https:&#x2F;&#x2F;github.com&#x2F;ethereum&#x2F;EIPs&#x2F;issues&#x2F;2266">https:&#x2F;&#x2F;github.com&#x2F;ethereum&#x2F;EIPs&#x2F;issues&#x2F;2266</a></td>
          </tr>
        

        <tr>
            <th>Status</th>
            <td>
                Draft
                
            </td>
        </tr>

        <tr>
            <th>Type</th>
            <td>Standards Track</td>
        </tr>

        
          <tr>
              <th>Category</th>
              <td>ERC</td>
          </tr>
        

        <tr>
            <th>Created</th>
            <td>2019-08-17</td>
        </tr>

        

        

        

        

        
  </table>

  
    <!--You can leave these HTML comments in your merged EIP and delete the visible duplicate text guides, they will not appear and may be helpful to refer to if you edit it again. This is the suggested template for new EIPs. Note that an EIP number will be assigned by an editor. When opening a pull request to submit your EIP, please use an abbreviated title in the filename, `eip-draft_title_abbrev.md`. The title should be 44 characters or less.-->
<h2 id="simple-summary">Simple Summary</h2>
<!--"If you can't explain it simply, you don't understand it well enough." Provide a simplified and layman-accessible explanation of the EIP.-->
<p>A standard for token contracts providing Atomic Swap-based American Call Option functionalities.</p>
<h2 id="abstarct">Abstarct</h2>
<p>This standard provides functionality to make Atomic Swap-based American Call Option payment. The Atomic Swap protocol based on Hashed Time-Locked Contract (HTLC) <sup class="footnote-reference"><a href="#1">1</a></sup> has optionality <sup class="footnote-reference"><a href="#2">2</a></sup>, and such optionality can be utilised to construct American Call Options without trusted third party. This standard defines the common way of implementing this protocol. In particular, this EIP defines technical terms, provides interfaces, and gives reference implementations of this protocol.</p>
<h2 id="motivation">Motivation</h2>
<!--The motivation is critical for EIPs that want to change the Ethereum protocol. It should clearly explain why the existing protocol specification is inadequate to address the problem that the EIP solves. EIP submissions without sufficient motivation may be rejected outright.-->
<p>Atomic Swap allows users to atomically exchange their tokens without trusted third parties while the HTLC is commonly used for the implementation. However, the HTLC-based Atomic Swap has optionality. More specifically, the swap initiator can choose to proceed or abort the swap for several hours, which gives him time for speculating according to the exchange rate. A discussion<sup class="footnote-reference"><a href="#2">2</a></sup> shows that the HTLC-based Atomic Swap is equivalent to an American Call Option in finance. On the other hand,thanks to such optionality, the HTLC-based Atomic Swap can be utilised to construct American Call Options without trusted third party. A paper<sup class="footnote-reference"><a href="#3">3</a></sup> proposes a secure Atomic-Swap-based American Call Option protocol on smart contracts. This protocol not only eliminates the arbitrage opportunity but also prevents any party from locking the other party's money maliciously. This EIP aims at providing the standard of implementing this protocol in existing token standards.</p>
<h2 id="specification">Specification</h2>
<!--The technical specification should describe the syntax and semantics of any new feature. The specification should be detailed enough to allow competing, interoperable implementations for any of the current Ethereum platforms (go-ethereum, parity, cpp-ethereum, ethereumj, ethereumjs, and [others](https://github.com/ethereum/wiki/wiki/Clients)).-->
<p>The Atomic Swap-based American Call Option smart contract should follow the syntax and semantics of Ethereum smart contracts.</p>
<h3 id="definitions">Definitions</h3>
<ul>
<li><code>initiator</code>: the party who publishes the advertisement of the swap.</li>
<li><code>participant</code>: the party who agrees on the advertisement and participates in the swap with <code>initiator</code>.</li>
<li><code>asset</code>: the amount of token(s) to be exchanged.</li>
<li><code>premium</code>: the amount of token(s) that <code>initiator</code> pays to <code>participant</code> as the premium.</li>
<li><code>redeem</code>: the action to claim the token from the other party.</li>
<li><code>refund</code>: the action to claim the token from the party herself/himself, because of timelock expiration.</li>
<li><code>secrect</code>: a random string chosen by <code>initiator</code> as the preimage of a hash.</li>
<li><code>secrectHash</code>: a string equals to the hash of <code>secrect</code>, used for constructing HTLCs.</li>
<li><code>timelock</code>: a timestamp representing the timelimit, before when the asset can be redeemed, and otherwise can only be refunded.</li>
</ul>
<h3 id="storage-variables">Storage Variables</h3>
<h4 id="swap">swap</h4>
<p>This mapping stores the metadata of the swap contracts, including the parties and tokens involved. Each contract uses different <code>secretHash</code>, and is distinguished by <code>secretHash</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">mapping(bytes32 =&gt; Swap) public swap;
</span></code></pre><h4 id="initiatorasset">initiatorAsset</h4>
<p>This mapping stores the detail of the asset initiators want to sell, including the amount, the timelock and the state. It is associated with the swap contract with the same <code>secretHash</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">mapping(bytes32 =&gt; InitiatorAsset) public initiatorAsset;
</span></code></pre><h4 id="participantasset">participantAsset</h4>
<p>This mapping stores the details of the asset participants want to sell, including the amount, the timelock and the state. It is associated with the swap contract with the same <code>secretHash</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">mapping(bytes32 =&gt; ParticipantAsset) public participantAsset;
</span></code></pre><h4 id="premiumasset">premiumAsset</h4>
<p>This mapping stores the details of the premium initiators attach in the swap contract, including the amount, the timelock and the state. It is associated with the swap contract with the same <code>secretHash</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">mapping(bytes32 =&gt; Premium) public premium;
</span></code></pre><h3 id="methods">Methods</h3>
<h4 id="setup">setup</h4>
<p>This function sets up the swap contract, including the both parties involved, the tokens to exchanged, and so on.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function setup(bytes32 secretHash, address payable initiator, address tokenA, address tokenB, uint256 initiatorAssetAmount, address payable participant, uint256 participantAssetAmount, uint256 premiumAmount) public payable
</span></code></pre><h4 id="initiate">initiate</h4>
<p>The initiator invokes this function to fill and lock the token she/he wants to sell and join the contract.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function initiate(bytes32 secretHash, uint256 assetRefundTime) public payable
</span></code></pre><h4 id="fillpremium">fillPremium</h4>
<p>The initiator invokes this function to fill and lock the premium.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function fillPremium(bytes32 secretHash, uint256 premiumRefundTime) public payable
</span></code></pre><h4 id="participate">participate</h4>
<p>The participant invokes this function to fill and lock the token she/he wants to sell and join the contract.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function participate(bytes32 secretHash, uint256 assetRefundTime) public payable
</span></code></pre><h4 id="redeemasset">redeemAsset</h4>
<p>One of the parties invokes this function to get the token from the other party, by providing the preimage of the hash lock <code>secret</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function redeemAsset(bytes32 secret, bytes32 secretHash) public
</span></code></pre><h4 id="refundasset">refundAsset</h4>
<p>One of the parties invokes this function to get the token back after the timelock expires.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function refundAsset(bytes32 secretHash) public
</span></code></pre><h4 id="redeempremium">redeemPremium</h4>
<p>The participant invokes this function to get the premium. This can be invoked only if the participant has already invoked <code>participate</code> and the participant's token is redeemed or refunded.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function redeemPremium(bytes32 secretHash) public
</span></code></pre><h4 id="refundpremium">refundPremium</h4>
<p>The initiator invokes this function to get the premium back after the timelock expires.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">function refundPremium(bytes32 secretHash) public
</span></code></pre><h3 id="events">Events</h3>
<h4 id="setup-1">SetUp</h4>
<p>This event indicates that one party has set up the contract using the function <code>setup()</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event SetUp(bytes32 secretHash, address initiator, address participant, address tokenA, address tokenB, uint256 initiatorAssetAmount, uint256 participantAssetAmount, uint256 premiumAmount);
</span></code></pre><h4 id="initiated">Initiated</h4>
<p>This event indicates that <code>initiator</code> has filled and locked the token to be exchanged using the function <code>initiate()</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event Initiated(uint256 initiateTimestamp, bytes32 secretHash, address initiator, address participant, address initiatorAssetToken, uint256 initiatorAssetAmount, uint256 initiatorAssetRefundTimestamp);
</span></code></pre><h4 id="participated">Participated</h4>
<p>This event indicates that <code>participant</code> has filled and locked the token to be exchanged using the function <code>participate()</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event Participated(uint256 participateTimestamp, bytes32 secretHash, address initiator, address participant, address participantAssetToken, uint256 participantAssetAmount, uint256 participantAssetRefundTimestamp);
</span></code></pre><h4 id="premiumfilled">PremiumFilled</h4>
<p>This event indicates that <code>initiator</code> has filled and locked <code>premium</code> using the function <code>fillPremium()</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event PremiumFilled(uint256 fillPremiumTimestamp, bytes32 secretHash, address initiator, address participant, address premiumToken, uint256 premiumAmount, uint256 premiumRefundTimestamp);
</span></code></pre><h4 id="initiatorassetredeemed-participantassetredeemed">InitiatorAssetRedeemed/ParticipantAssetRedeemed</h4>
<p>These two events indicate that <code>asset</code> has been redeemed by the other party before the timelock by providing <code>secret</code>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event InitiatorAssetRedeemed(uint256 redeemTimestamp, bytes32 secretHash, bytes32 secret, address redeemer, address assetToken, uint256 amount);
</span></code></pre><pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event ParticipantAssetRedeemed(uint256 redeemTimestamp, bytes32 secretHash, bytes32 secret, address redeemer, address assetToken, uint256 amount);
</span></code></pre><h4 id="initiatorassetrefunded-participantassetrefunded">InitiatorAssetRefunded/ParticipantAssetRefunded</h4>
<p>These two events indicate that <code>asset</code> has been refunded by the original owner after the timelock expires.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event InitiatorAssetRefunded(uint256 refundTimestamp, bytes32 secretHash, address refunder, address assetToken, uint256 amount);
</span></code></pre><pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event ParticipantAssetRefunded(uint256 refundTimestamp, bytes32 secretHash, address refunder, address assetToken, uint256 amount);
</span></code></pre><h4 id="premiumredeemed">PremiumRedeemed</h4>
<p>This event indicates that <code>premium</code> has been redeemed by <code>participant</code>. This implies that <code>asset</code> is either redeemed by <code>initiator</code> if it can provide the preimage of <code>secrectHash</code> before  <code>asset</code> timelock expires; or refunded by <code>participant</code> if <code>asset</code> timelock expires.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event PremiumRedeemed(uint256 redeemTimestamp,bytes32 secretHash,address redeemer,address token,uint256 amount);
</span></code></pre><h4 id="premiumrefunded">PremiumRefunded</h4>
<p>This event indicates that <code>premium</code> has been refunded back to <code>initiator</code>, because of <code>participant</code> doesn't participate at all, by the time of <code>premium</code> timelock expires.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">event PremiumRefunded(uint256 refundTimestamp, bytes32 secretHash, address refunder, address token, uint256 amount);
</span></code></pre><h2 id="rationale">Rationale</h2>
<!--The rationale fleshes out the specification by describing what motivated the design and why particular design decisions were made. It should describe alternate designs that were considered and related work, e.g. how the feature is supported in other languages. The rationale may also provide evidence of consensus within the community, and should discuss important objections or concerns raised during discussion.-->
<ul>
<li>To achieve the atomicity, HTLC is used.</li>
<li>The participant should decide whether to participate after the initiator locks the token and sets up the timelock.</li>
<li>The initiator should decide whether to proceed the swap (redeem the tokens from the participant and reveal the preimage of the hash lock), after the participant locks the tokens and sets up the time locks.</li>
<li>Premium is redeemable for the participant only if the participant participates in the swap and redeems the initiator's token before premium's timelock expires.</li>
<li>Premium is refundable for the initiator only if the initiator initiates but the participant does not participate in the swap at all.</li>
</ul>
<h2 id="backwards-compatibility">Backwards Compatibility</h2>
<!--All EIPs that introduce backwards incompatibilities must include a section describing these incompatibilities and their severity. The EIP must explain how the author proposes to deal with these incompatibilities. EIP submissions without a sufficient backwards compatibility treatise may be rejected outright.-->
<p>This proposal is fully backward compatible. Functionalities of existing standards will not be affected by this proposal, as it only provides additional features to them.</p>
<h2 id="implementation">Implementation</h2>
<!--The implementations must be completed before any EIP is given status "Final", but it need not be completed before the EIP is accepted. While there is merit to the approach of reaching consensus on the specification and rationale before writing code, the principle of "rough consensus and running code" is still useful when it comes to resolving many discussions of API details.-->
<p>Please visit <a href="https://github.com/HAOYUatHZ/fair-atomic-swap/blob/master/src/atomicswap/eip2266/">here</a> to find our example implementation.</p>
<h2 id="copyright">Copyright</h2>
<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://en.bitcoin.it/wiki/Hash_Time_Locked_Contracts">Hash Time Locked Contracts</a></p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p><a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-January/001798.html">An Argument For Single-Asset Lightning Network</a></p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">3</sup>
<p><a href="https://eprint.iacr.org/2019/896">On the optionality and fairness of Atomic Swaps</a></p>
</div>



            </div>
        </main>


        <footer class="site-footer h-card">
            <div class="wrapper">
                <h2 class="footer-heading">Ethereum Improvement Proposals</h2>
                <div class="footer-col-wrapper">
                    <div class="footer-col footer-col-1">
                        <ul class="contact-list">
                            <li class="p-name">
                                
                                GitHub User
                                
                            </li>
                            <li>
                                <a class="u-email" href="mailto:your-email@domain.com">
                                  your-email@domain.com
                                </a>
                              </li>
                            </ul>
                    </div>
                    <div class="footer-col footer-col-3">
                        <p>Description</p>
                    </div>
                </div>
            </div>
        </footer>
    </body>
</html>
