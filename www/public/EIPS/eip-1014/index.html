<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https:&#x2F;&#x2F;eips.ethereum.com&#x2F;minima.css">

        <!-- opengraph -->
        <meta property="og:locale" content="en_US" />
        <meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.com" />
        <meta property="og:site_name" content="Ethereum Improvement Proposals" />

        <!-- twitter -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@ethereum" />

        <script type="application/ld+json">
            {
              "@type": "WebSite",
              "url": "https:&#x2F;&#x2F;eips.ethereum.com",
              "name": "Ethereum Improvement Proposals",
              "description": "Description",
              "@context": "https://schema.org"
            }
        </script>

        

        

<title>EIP-1014: Skinny CREATE2</title>
<link rel="canonical" href="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-1014.md" />
<meta property="og:title" content="EIP-1014: Skinny CREATE2" />
<meta
    name="description"
    content="Details on Ethereum Improvement Proposal 1014 (EIP-1014): Skinny CREATE2"
/>
<meta
    property="og:description"
    content="Details on Ethereum Improvement Proposal 1014 (EIP-1014): Skinny CREATE2"
/>
<meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-1014.md" />
<meta name="twitter:description" content="Details on Ethereum Improvement Proposal 1014 (EIP 1014): Skinny CREATE2" />

    </head>
    <body>
        <header class="site-header">
            <div class="wrapper">
                <a class="site-title" rel="author" href="https:&#x2F;&#x2F;eips.ethereum.com">Ethereum Improvement Proposals</a>
                <nav class="site-nav">
                    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                    <label for="nav-trigger">
                        <span class="menu-icon">
                            <svg viewBox="0 0 18 15" width="18px" height="15px">
                                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                            </svg>
                        </span>
                    </label>

                    <div class="trigger">
                        
                            <a class="page-link" href="&#x2F;all">All</a>
                        
                            <a class="page-link" href="&#x2F;core">Core</a>
                        
                            <a class="page-link" href="&#x2F;networking">Networking</a>
                        
                            <a class="page-link" href="&#x2F;interface">Interface</a>
                        
                            <a class="page-link" href="&#x2F;erc">ERC</a>
                        
                            <a class="page-link" href="&#x2F;meta">Meta</a>
                        
                            <a class="page-link" href="&#x2F;informational">Informational</a>
                        
                    </div>
                </nav>
            </div>
        </header>
        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                
<div class="home">
    <h1 class="page-heading">
        EIP-1014: Skinny CREATE2
        <a href=""><svg role="img" aria-label="Source" xmlns="https://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><title>Source</title><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"/></svg></a>
    </h1>
    <table>
        <tr>
            <th>Author</th>
            <td>
    
        
        
            <a href="https://github.com/vbuterin">Vitalik Buterin</a>
        
    
</td>
        </tr>

        

        <tr>
            <th>Status</th>
            <td>
                Final
                
            </td>
        </tr>

        <tr>
            <th>Type</th>
            <td>Standards Track</td>
        </tr>

        
          <tr>
              <th>Category</th>
              <td>Core</td>
          </tr>
        

        <tr>
            <th>Created</th>
            <td>2018-04-20</td>
        </tr>

        

        

        

        

        
  </table>

  
    <h3 id="specification">Specification</h3>
<p>Adds a new opcode at 0xf5, which takes 4 stack arguments: endowment, memory_start, memory_length, salt. Behaves identically to CREATE, except using <code>keccak256( 0xff ++ address ++ salt ++ keccak256(init_code))[12:]</code> instead of the usual sender-and-nonce-hash as the address where the contract is initialized at. </p>
<p>The <code>CREATE2</code> has the same <code>gas</code> schema as <code>CREATE</code>, but also an extra <code>hashcost</code> of <code>GSHA3WORD * ceil(len(init_code) / 32)</code>, to account for the hashing that must be performed. The <code>hashcost</code> is deducted at the same time as memory-expansion gas and <code>CreateGas</code> is deducted: <em>before</em> evaluation of the resulting address and the execution of <code>init_code</code>.</p>
<ul>
<li><code>0xff</code> is a single byte, </li>
<li><code>address</code> is always <code>20</code> bytes, </li>
<li><code>salt</code> is always <code>32</code> bytes (a stack item). </li>
</ul>
<p>The preimage for the final hashing round is thus always exactly <code>85</code> bytes long.</p>
<p>The coredev-call at 2018-08-10 decided to use the formula above. </p>
<h3 id="motivation">Motivation</h3>
<p>Allows interactions to (actually or counterfactually in channels) be made with addresses that do not exist yet on-chain but can be relied on to only possibly eventually contain code that has been created by a particular piece of init code. Important for state-channel use cases that involve counterfactual interactions with contracts.</p>
<h3 id="rationale">Rationale</h3>
<h4 id="address-formula">Address formula</h4>
<ul>
<li>Ensures that addresses created with this scheme cannot collide with addresses created using the traditional <code>keccak256(rlp([sender, nonce]))</code> formula, as <code>0xff</code> can only be a starting byte for RLP for data many petabytes long.</li>
<li>Ensures that the hash preimage has a fixed size,</li>
</ul>
<h4 id="gas-cost">Gas cost</h4>
<p>Since address calculation depends on hashing the <code>init_code</code>, it would leave clients open to DoS attacks if executions could repeatedly cause hashing of large pieces of <code>init_code</code>, since expansion of memory is paid for only once. This EIP uses the same cost-per-word as the <code>SHA3</code> opcode. </p>
<h3 id="clarifications">Clarifications</h3>
<p>The <code>init_code</code> is the code that, when executed, produces the runtime bytecode that will be placed into the state, and which typically is used by high level languages to implement a 'constructor'.</p>
<p>This EIP makes collisions possible. The behaviour at collisions is specified by <a href="https://github.com/ethereum/EIPs/issues/684">EIP 684</a>:</p>
<blockquote>
<p>If a contract creation is attempted, due to either a creation transaction or the CREATE (or future CREATE2) opcode, and the destination address already has either nonzero nonce, or nonempty code, then the creation throws immediately, with exactly the same behavior as would arise if the first byte in the init code were an invalid opcode. This applies retroactively starting from genesis.</p>
</blockquote>
<p>Specifically, if <code>nonce</code> or <code>code</code> is nonzero, then the create-operation fails. </p>
<p>With <a href="https://eips.ethereum.org/EIPS/eip-161">EIP 161</a> </p>
<blockquote>
<p>Account creation transactions and the CREATE operation SHALL, prior to the execution of the initialisation code, increment the nonce over and above its normal starting value by one</p>
</blockquote>
<p>This means that if a contract is created in a transaction, the <code>nonce</code> is immediately non-zero, with the side-effect that a collision within the same transaction will always fail -- even if it's carried out from the <code>init_code</code> itself.</p>
<p>It should also be noted that <code>SELFDESTRUCT</code> has no immediate effect on <code>nonce</code> or <code>code</code>, thus a contract cannot be destroyed and recreated within one transaction. </p>
<h3 id="examples">Examples</h3>
<p>Example 0</p>
<ul>
<li>address <code>0x0000000000000000000000000000000000000000</code></li>
<li>salt <code>0x0000000000000000000000000000000000000000000000000000000000000000</code></li>
<li>init_code <code>0x00</code></li>
<li>gas (assuming no mem expansion): <code>32006</code></li>
<li>result: <code>0x4D1A2e2bB4F88F0250f26Ffff098B0b30B26BF38</code></li>
</ul>
<p>Example 1</p>
<ul>
<li>address <code>0xdeadbeef00000000000000000000000000000000</code></li>
<li>salt <code>0x0000000000000000000000000000000000000000000000000000000000000000</code></li>
<li>init_code <code>0x00</code></li>
<li>gas (assuming no mem expansion): <code>32006</code></li>
<li>result: <code>0xB928f69Bb1D91Cd65274e3c79d8986362984fDA3</code></li>
</ul>
<p>Example 2</p>
<ul>
<li>address <code>0xdeadbeef00000000000000000000000000000000</code></li>
<li>salt <code>0x000000000000000000000000feed000000000000000000000000000000000000</code></li>
<li>init_code <code>0x00</code></li>
<li>gas (assuming no mem expansion): <code>32006</code></li>
<li>result: <code>0xD04116cDd17beBE565EB2422F2497E06cC1C9833</code></li>
</ul>
<p>Example 3</p>
<ul>
<li>address <code>0x0000000000000000000000000000000000000000</code></li>
<li>salt <code>0x0000000000000000000000000000000000000000000000000000000000000000</code></li>
<li>init_code <code>0xdeadbeef</code></li>
<li>gas (assuming no mem expansion): <code>32006</code></li>
<li>result: <code>0x70f2b2914A2a4b783FaEFb75f459A580616Fcb5e</code></li>
</ul>
<p>Example 4</p>
<ul>
<li>address <code>0x00000000000000000000000000000000deadbeef</code></li>
<li>salt <code>0x00000000000000000000000000000000000000000000000000000000cafebabe</code></li>
<li>init_code <code>0xdeadbeef</code></li>
<li>gas (assuming no mem expansion): <code>32006</code></li>
<li>result: <code>0x60f3f640a8508fC6a86d45DF051962668E1e8AC7</code></li>
</ul>
<p>Example 5</p>
<ul>
<li>address <code>0x00000000000000000000000000000000deadbeef</code></li>
<li>salt <code>0x00000000000000000000000000000000000000000000000000000000cafebabe</code></li>
<li>init_code <code>0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef</code></li>
<li>gas (assuming no mem expansion): <code>32012</code></li>
<li>result: <code>0x1d8bfDC5D46DC4f61D6b6115972536eBE6A8854C</code></li>
</ul>
<p>Example 6</p>
<ul>
<li>address <code>0x0000000000000000000000000000000000000000</code></li>
<li>salt <code>0x0000000000000000000000000000000000000000000000000000000000000000</code></li>
<li>init_code <code>0x</code></li>
<li>gas (assuming no mem expansion): <code>32000</code></li>
<li>result: <code>0xE33C0C7F7df4809055C3ebA6c09CFe4BaF1BD9e0</code></li>
</ul>



            </div>
        </main>


        <footer class="site-footer h-card">
            <div class="wrapper">
                <h2 class="footer-heading">Ethereum Improvement Proposals</h2>
                <div class="footer-col-wrapper">
                    <div class="footer-col footer-col-1">
                        <ul class="contact-list">
                            <li class="p-name">
                                
                                GitHub User
                                
                            </li>
                            <li>
                                <a class="u-email" href="mailto:your-email@domain.com">
                                  your-email@domain.com
                                </a>
                              </li>
                            </ul>
                    </div>
                    <div class="footer-col footer-col-3">
                        <p>Description</p>
                    </div>
                </div>
            </div>
        </footer>
    </body>
</html>
