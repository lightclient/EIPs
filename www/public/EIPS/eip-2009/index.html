<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https:&#x2F;&#x2F;eips.ethereum.com&#x2F;minima.css">

        <!-- opengraph -->
        <meta property="og:locale" content="en_US" />
        <meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.com" />
        <meta property="og:site_name" content="Ethereum Improvement Proposals" />

        <!-- twitter -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@ethereum" />

        <script type="application/ld+json">
            {
              "@type": "WebSite",
              "url": "https:&#x2F;&#x2F;eips.ethereum.com",
              "name": "Ethereum Improvement Proposals",
              "description": "Description",
              "@context": "https://schema.org"
            }
        </script>

        

        

<title>EIP-2009: Compliance Service</title>
<link rel="canonical" href="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-2009.md" />
<meta property="og:title" content="EIP-2009: Compliance Service" />
<meta
    name="description"
    content="Details on Ethereum Improvement Proposal 2009 (EIP-2009): Compliance Service"
/>
<meta
    property="og:description"
    content="Details on Ethereum Improvement Proposal 2009 (EIP-2009): Compliance Service"
/>
<meta property="og:url" content="https:&#x2F;&#x2F;eips.ethereum.comEIPS&#x2F;eip-2009.md" />
<meta name="twitter:description" content="Details on Ethereum Improvement Proposal 2009 (EIP 2009): Compliance Service" />

    </head>
    <body>
        <header class="site-header">
            <div class="wrapper">
                <a class="site-title" rel="author" href="https:&#x2F;&#x2F;eips.ethereum.com">Ethereum Improvement Proposals</a>
                <nav class="site-nav">
                    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                    <label for="nav-trigger">
                        <span class="menu-icon">
                            <svg viewBox="0 0 18 15" width="18px" height="15px">
                                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                            </svg>
                        </span>
                    </label>

                    <div class="trigger">
                        
                            <a class="page-link" href="&#x2F;all">All</a>
                        
                            <a class="page-link" href="&#x2F;core">Core</a>
                        
                            <a class="page-link" href="&#x2F;networking">Networking</a>
                        
                            <a class="page-link" href="&#x2F;interface">Interface</a>
                        
                            <a class="page-link" href="&#x2F;erc">ERC</a>
                        
                            <a class="page-link" href="&#x2F;meta">Meta</a>
                        
                            <a class="page-link" href="&#x2F;informational">Informational</a>
                        
                    </div>
                </nav>
            </div>
        </header>
        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                
<div class="home">
    <h1 class="page-heading">
        EIP-2009: Compliance Service
        <a href=""><svg role="img" aria-label="Source" xmlns="https://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><title>Source</title><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"/></svg></a>
    </h1>
    <table>
        <tr>
            <th>Author</th>
            <td>
    
        
        
            <a href="mailto:daniel@io.builders">Daniel Lehrner</a>
        
    
</td>
        </tr>

        
          <tr>
              <th>Discussions-To</th>
              <td><a href="https:&#x2F;&#x2F;github.com&#x2F;ethereum&#x2F;EIPs&#x2F;issues&#x2F;2022">https:&#x2F;&#x2F;github.com&#x2F;ethereum&#x2F;EIPs&#x2F;issues&#x2F;2022</a></td>
          </tr>
        

        <tr>
            <th>Status</th>
            <td>
                Draft
                
            </td>
        </tr>

        <tr>
            <th>Type</th>
            <td>Standards Track</td>
        </tr>

        
          <tr>
              <th>Category</th>
              <td>ERC</td>
          </tr>
        

        <tr>
            <th>Created</th>
            <td>2019-05-09</td>
        </tr>

        

        
          <tr>
              <th>Requires</th>
              <td>1066</td>
          </tr>
        

        

        

        
  </table>

  
    <h2 id="simple-summary">Simple Summary</h2>
<p>This EIP proposes a service for decentralized compliance checks for regulated tokens. </p>
<h2 id="actors">Actors</h2>
<h4 id="operator">Operator</h4>
<p>An account which has been approved by a token to update the tokens accumulated.</p>
<h4 id="token">Token</h4>
<p>An account, normally a smart contract, which uses the <code>Compliance Service</code> to check if the an action can be executed or not.</p>
<h4 id="token-holder">Token holder</h4>
<p>An account which is in possession of tokens and on for which the checks are made.</p>
<h2 id="abstract">Abstract</h2>
<p>A regulated token needs to comply with several legal requirements, especially <a href="https://en.wikipedia.org/wiki/Know_your_customer">KYC</a> and <a href="https://en.wikipedia.org/wiki/Money_laundering#Anti-money_laundering">AML</a>. If the necessary checks have to be made off-chain the token transfer becomes centralized. Further the transfer in this case takes longer to complete as it can not be done in one transaction, but requires a second confirmation step. The goal of this proposal is to make this second step unnecessary by providing a service for compliance checks.</p>
<h2 id="motivation">Motivation</h2>
<p>Currently there is no proposal on how to accomplish decentralized compliance checks. <a href="https://eips.ethereum.org/EIPS/eip-1462">ERC-1462</a> proposes a basic set of functions to check if <code>transfer</code>, <code>mint</code> and <code>burn</code> are allowed for a user, but not how those checks should be implemented. This EIP proposes a way to implement them fully on-chain while being generic enough to leave the actual implementation of the checks up to the implementers, as these may vary a lot between different tokens.</p>
<p>The proposed <code>Compliance Service</code> supports more than one token. Therefore it could be used by law-makers to maintain the compliance rules of regulated tokens in one smart contract. This smart contract could be used by all of the tokens that fall under this jurisdiction and ensure compliance with the current laws.</p>
<p>By having a standard for compliance checks third-party developers can use them to verify if token movements for a specific account are allowed and act accordingly.</p>
<h2 id="specification">Specification</h2>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">interface CompliantService {
    function checkTransferAllowed(bytes32 tokenId, address from, address to, uint256 value) external view returns (byte);
    function checkTransferFromAllowed(bytes32 tokenId, address sender, address from, address to, uint256 value) external view returns (byte);
    function checkMintAllowed(bytes32 tokenId, address to, uint256 value) external view returns (byte);
    function checkBurnAllowed(bytes32 tokenId, address from, uint256 value) external view returns (byte);
    
    function updateTransferAccumulated(bytes32 tokenId, address from, address to, uint256 value) external;
    function updateMintAccumulated(bytes32 tokenId, address to, uint256 value) external;
    function updateBurnAccumulated(bytes32 tokenId, address from, uint256 value) external;
    
    function addToken(bytes32 tokenId, address token) external;
    function replaceToken(bytes32 tokenId, address token) external;
    function removeToken(bytes32 tokenId) external;
    function isToken(address token) external view returns (bool);
    function getTokenId(address token) external view returns (bytes32);
    
    function authorizeAccumulatedOperator(address operator) external returns (bool);
    function revokeAccumulatedOperator(address operator) external returns (bool);
    function isAccumulatedOperatorFor(address operator, bytes32 tokenId) external view returns (bool);
    
    event TokenAdded(bytes32 indexed tokenId, address indexed token);
    event TokenReplaced(bytes32 indexed tokenId, address indexed previousAddress, address indexed newAddress);
    event TokenRemoved(bytes32 indexed tokenId);
    event AuthorizedAccumulatedOperator(address indexed operator, bytes32 indexed tokenId);
    event RevokedAccumulatedOperator(address indexed operator, bytes32 indexed tokenId);
}
</span></code></pre><h3 id="mandatory-checks">Mandatory checks</h3>
<p>The checks must be verified in their corresponding actions. The action must only be successful if the check return an <code>Allowed</code> status code. In any other case the functions must revert.</p>
<h3 id="status-codes">Status codes</h3>
<p>If an action is allowed <code>0x11</code> (Allowed) or an issuer-specific code with equivalent but more precise meaning must be returned. If the action is not allowed the status must be <code>0x10</code> (Disallowed) or an issuer-specific code with equivalent but more precise meaning. </p>
<h3 id="functions">Functions</h3>
<h4 id="checktransferallowed">checkTransferAllowed</h4>
<p>Checks if the <code>transfer</code> function is allowed to be executed with the given parameters.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>from</td><td>The address of the payer, from whom the tokens are to be taken if executed</td></tr>
<tr><td>to</td><td>The address of the payee, to whom the tokens are to be transferred if executed</td></tr>
<tr><td>value</td><td>The amount to be transferred</td></tr>
</tbody></table>
<h4 id="checktransferfromallowed">checkTransferFromAllowed</h4>
<p>Checks if the <code>transferFrom</code> function is allowed to be executed with the given parameters.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>sender</td><td>The address of the sender, who initiated the transaction</td></tr>
<tr><td>from</td><td>The address of the payer, from whom the tokens are to be taken if executed</td></tr>
<tr><td>to</td><td>The address of the payee, to whom the tokens are to be transferred if executed</td></tr>
<tr><td>value</td><td>The amount to be transferred</td></tr>
</tbody></table>
<h4 id="checkmintallowed">checkMintAllowed</h4>
<p>Checks if the <code>mint</code> function is allowed to be executed with the given parameters.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>to</td><td>The address of the payee, to whom the tokens are to be given if executed</td></tr>
<tr><td>value</td><td>The amount to be minted</td></tr>
</tbody></table>
<h4 id="checkburnallowed">checkBurnAllowed</h4>
<p>Checks if the <code>burn</code> function is allowed to be executed with the given parameters.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>from</td><td>The address of the payer, from whom the tokens are to be taken if executed</td></tr>
<tr><td>value</td><td>The amount to be burned</td></tr>
</tbody></table>
<h4 id="updatetransferaccumulated">updateTransferAccumulated</h4>
<p>Must be called in the same transaction as <code>transfer</code> or <code>transferFrom</code>. It must revert if the update violates any of the compliance rules. It is up to the implementer which specific logic is executed in the function.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>from</td><td>The address of the payer, from whom the tokens are to be taken if executed</td></tr>
<tr><td>to</td><td>The address of the payee, to whom the tokens are to be transferred if executed</td></tr>
<tr><td>value</td><td>The amount to be transferred</td></tr>
</tbody></table>
<h4 id="updatemintaccumulated">updateMintAccumulated</h4>
<p>Must be called in the same transaction as <code>mint</code>. It must revert if the update violates any of the compliance rules. It is up to the implementer which specific logic is executed in the function.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>to</td><td>The address of the payee, to whom the tokens are to be given if executed</td></tr>
<tr><td>value</td><td>The amount to be minted</td></tr>
</tbody></table>
<h4 id="updateburnaccumulated">updateBurnAccumulated</h4>
<p>Must be called in the same transaction as <code>burn</code>. It must revert if the update violates any of the compliance rules. It is up to the implementer which specific logic is executed in the function.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>from</td><td>The address of the payer, from whom the tokens are to be taken if executed</td></tr>
<tr><td>value</td><td>The amount to be minted</td></tr>
</tbody></table>
<h4 id="addtoken">addToken</h4>
<p>Adds a token to the service, which allows the token to call the functions to update the accumulated. If an existing token id is used the function must revert. It is up to the implementer if adding a token should be restricted or not.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>token</td><td>The address from which the update functions will be called</td></tr>
</tbody></table>
<h4 id="replacetoken">replaceToken</h4>
<p>Replaces the address of a added token with another one. It is up to the implementer if replacing a token should be restricted or not, but a token should be able to replace its own address.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>token</td><td>The address from which the update functions will be called</td></tr>
</tbody></table>
<h4 id="removetoken">removeToken</h4>
<p>Removes a token from the service, which disallows the token to call the functions to update the accumulated. It is up to the implementer if removing a token should be restricted or not.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
</tbody></table>
<h4 id="istoken">isToken</h4>
<p>Returns <code>true</code> if the address has been added to the service, <code>false</code> if not.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>token</td><td>The address which should be checked</td></tr>
</tbody></table>
<h4 id="gettokenid">getTokenId</h4>
<p>Returns the token id of a token. If the token has not been added to the service, '0' must be returned.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>token</td><td>The address which token id should be returned</td></tr>
</tbody></table>
<h4 id="authorizeaccumulatedoperator">authorizeAccumulatedOperator</h4>
<p>Approves an operator to update accumulated on behalf of the token id of msg.sender.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>operator</td><td>The address to be approved as operator of accumulated updates</td></tr>
</tbody></table>
<h4 id="revokeaccumulatedoperator">revokeAccumulatedOperator</h4>
<p>Revokes the approval to update accumulated on behalf the token id the token id ofof msg.sender.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>operator</td><td>The address to be revoked as operator of accumulated updates</td></tr>
</tbody></table>
<h4 id="isaccumulatedoperatorfor">isAccumulatedOperatorFor</h4>
<p>Retrieves if an operator is approved to create holds on behalf of <code>tokenId</code>.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>operator</td><td>The address which is operator of updating the accumulated</td></tr>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
</tbody></table>
<h3 id="events">Events</h3>
<h4 id="tokenadded">TokenAdded</h4>
<p>Must be emitted after a token has been added.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>token</td><td>The address from which the update functions will be called</td></tr>
</tbody></table>
<h4 id="tokenreplaced">TokenReplaced</h4>
<p>Must be emitted after the address of a token has been replaced.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
<tr><td>previousAddress</td><td>The previous address which was used before</td></tr>
<tr><td>newAddress</td><td>The address which will be used from now on</td></tr>
</tbody></table>
<h4 id="tokenremoved">TokenRemoved</h4>
<p>Must be emitted after the a token has been removed.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>tokenId</td><td>The unique ID which identifies a token</td></tr>
</tbody></table>
<h4 id="authorizedaccumulatedoperator">AuthorizedAccumulatedOperator</h4>
<p>Emitted when an operator has been approved to update the accumulated on behalf of a token.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>operator</td><td>The address which is operator of updating the accumulated</td></tr>
<tr><td>tokenId</td><td>Token id on which behalf updates of the accumulated will potentially be made</td></tr>
</tbody></table>
<h4 id="revokedholdoperator">RevokedHoldOperator</h4>
<p>Emitted when an operator has been revoked from updating the accumulated on behalf of a token.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>operator</td><td>The address which was operator of updating the accumulated</td></tr>
<tr><td>tokenId</td><td>Token id on which behalf updates of the accumulated could be made</td></tr>
</tbody></table>
<h2 id="rationale">Rationale</h2>
<p>The usage of a token id instead of the address has been chosen to give tokens the possibility to update their smart contracts and keeping all their associated accumulated. If the address would be used, a migration process would needed to be done after a smart contract update.</p>
<p>No event is emitted after updating the accumulated as those are always associated with a <code>transfer</code>, <code>mint</code> or <code>burn</code> of a token which already emits an event of itself.</p>
<p>While not requiring it, the naming of the functions <code>checkTransferAllowed</code>, <code>checkTransferFromAllowed</code>, <code>checkMintAllowed</code> and <code>checkBurnAllowed</code> was adopted from <a href="https://eips.ethereum.org/EIPS/eip-1462">ERC-1462</a>.</p>
<p>While not requiring it, the naming of the functions <code>authorizeAccumulatedOperator</code>, <code>revokeAccumulatedOperator</code> and <code>isAccumulatedOperatorFor</code> follows the naming convention of <a href="https://eips.ethereum.org/EIPS/eip-777">ERC-777</a>.</p>
<p>Localization is not part of this EIP, but <a href="https://eips.ethereum.org/EIPS/eip-1066">ERC-1066</a> and <a href="https://eips.ethereum.org/EIPS/eip-1444">ERC-1444</a> can be used together to achieve it.</p>
<h2 id="backwards-compatibility">Backwards Compatibility</h2>
<p>As the EIP is not using any existing EIP there are no backwards compatibilities to take into consideration.</p>
<h2 id="implementation">Implementation</h2>
<p>The GitHub repository <a href="https://github.com/IoBuilders/compliance-service">IoBuilders/compliance-service</a> contains the work in progress implementation.</p>
<h2 id="contributors">Contributors</h2>
<p>This proposal has been collaboratively implemented by <a href="https://adhara.io/">adhara.io</a> and <a href="https://io.builders/">io.builders</a>.</p>
<h2 id="copyright">Copyright</h2>
<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>



            </div>
        </main>


        <footer class="site-footer h-card">
            <div class="wrapper">
                <h2 class="footer-heading">Ethereum Improvement Proposals</h2>
                <div class="footer-col-wrapper">
                    <div class="footer-col footer-col-1">
                        <ul class="contact-list">
                            <li class="p-name">
                                
                                GitHub User
                                
                            </li>
                            <li>
                                <a class="u-email" href="mailto:your-email@domain.com">
                                  your-email@domain.com
                                </a>
                              </li>
                            </ul>
                    </div>
                    <div class="footer-col footer-col-3">
                        <p>Description</p>
                    </div>
                </div>
            </div>
        </footer>
    </body>
</html>
